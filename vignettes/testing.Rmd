---
title: "Testing stuff"
author: "Cristina Mullin, mullin.cristina@epa.gov"
date: "May 1, 2022"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Testing stuff}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Load TADA library and update internal TADA package validation and reference tables
```{r setup}
library(TADA)
UpdateWQXCharValRef()
#UpdateMeasureUnitRef()
#HarmonizationRefTable()
```

Read in WQP data using WQP web services directly 

Go to the WQP website (https://www.waterqualitydata.us/) and fill out the 
query form. Choose the Full Physical Chemical Data Profile, all data sources, 
and the file format Comma-Separated. Do not hit the download button. Instead, 
copy the web service URL located at the bottom of the page under "Result". 

Use that "Result" web service URL as the input for this function to download data 
directly into R.  

Here are two "Result" web service examples: 

CT Nutrient Group: https://www.waterqualitydata.us/data/Result/search?statecode=US%3A09&countycode=US%3A09%3A003&characteristicType=Nutrient&mimeType=csv&zip=yes&dataProfile=resultPhysChem&providers=NWIS&providers=STEWARDS&providers=STORET

PA Nutrient Group: https://www.waterqualitydata.us/data/Result/search?statecode=US%3A42&characteristicType=Nutrient&mimeType=csv&zip=yes&dataProfile=resultPhysChem&providers=NWIS&providers=STEWARDS&providers=STORET

Note: It may be useful to save the Query URL as well as a comment within 
your code. This URL let's you return to the WQP query page with all your 
original data filters, but it cannot be used to download the data.

WQP query URL: https://www.waterqualitydata.us/#statecode=US%3A42&characteristicType=Nutrient&mimeType=csv&dataProfile=resultPhysChem&providers=NWIS&providers=STEWARDS&providers=STORET

```{r}
#get PA nutrient data
TADAProfileRaw=readWQPwebservice("https://www.waterqualitydata.us/data/Result/search?statecode=US%3A42&siteType=Lake%2C%20Reservoir%2C%20Impoundment&sampleMedia=water&sampleMedia=Water&characteristicType=Nutrient&startDateLo=01-01-2019&startDateHi=01-01-2022&mimeType=csv&zip=yes&dataProfile=resultPhysChem&providers=NWIS&providers=STEWARDS&providers=STORET")
```


Clean raw data for TADA use case
```{r}
#autoclean
TADAProfileClean=AggregatedContinuousData(TADAProfileRaw)
```

Run result flag functions and address flagged data
```{r}
#TADAProfileClean=UncommonAnalyticalMethodID(TADAProfileClean)
TADAProfileClean=PotentialDuplicateRowID(TADAProfileClean)
TADAProfileClean=AboveNationalWQXUpperThreshold(TADAProfileClean)
TADAProfileClean=BelowNationalWQXUpperThreshold(TADAProfileClean)
TADAProfileClean=QAPPapproved(TADAProfileClean)
TADAProfileClean=QAPPDocAvailable(TADAProfileClean)
TADAProfileClean=InvalidCoordinates(TADAProfileClean)
TADAProfileClean=InvalidFraction(TADAProfileClean)
TADAProfileClean=InvalidSpeciation(TADAProfileClean)
TADAProfileClean=InvalidResultUnit(TADAProfileClean)
```

Address result values with special characters
```{r}
TADAProfileClean=MeasureValueSpecialCharacters(TADAProfileClean)
```

Apply unit conversions
```{r}
TADAProfileClean=DepthProfileData(TADAProfileClean)
TADAProfileClean=WQXTargetUnits(TADAProfileClean)
```

Transform Characteristic, Speciation, and Unit values to TADA Standards
```{r}
TADAProfileClean=HarmonizeData(TADAProfileClean)
```

